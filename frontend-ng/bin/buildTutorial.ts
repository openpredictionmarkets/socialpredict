#!/usr/bin/env ts-node

import fs from 'node:fs';
import path from 'node:path';
import { fileURLToPath } from 'node:url';
import { defaultTutorialSteps } from '../src/config/tutorial_steps.ts';

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);
const outPath = path.resolve(__dirname, '../src/lib/components/TutorialModal.svelte');

// Expect exactly 5 steps (as currently defined)
if (defaultTutorialSteps.length !== 5) {
  throw new Error(
    `buildTutorial: expected 5 tutorial steps, found ${defaultTutorialSteps.length}. ` +
      `If you add/remove steps, update buildTutorial.ts logic accordingly.`
  );
}

const [step0, step1, step2, step3, step4] = defaultTutorialSteps;

// Helper: JSON string literal for use inside {@html ...}
const html = (value: string | undefined) => JSON.stringify(value ?? '');

// Step 0, 2, 3, 4 descriptions are HTML strings
const step0Title = html(step0.title);
const step0Desc = html(step0.description as string);
const step0Note = html(step0.note as string | undefined);

const step2Title = html(step2.title);
const step2Desc = html(step2.description as string);
const step2Note = html(step2.note as string | undefined);

const step3Title = html(step3.title);
const step3Desc = html(step3.description as string);
const step3Note = html(step3.note as string | undefined);

const step4Title = html(step4.title);
const step4Desc = html(step4.description as string);
const step4Note = html(step4.note as string | undefined);

// Step 1 is the “Tour a market…” feature list
if (!Array.isArray(step1.description)) {
  throw new Error('buildTutorial: step 1 description is expected to be FeatureDescription[].');
}

const step1Title = html(step1.title);
const step1Note = html(step1.note as string | undefined);

// Build the feature list <li> items for step 1 inline
const featureItems = (step1.description as any[])
  .map((feature) => {
    const key = feature.key as string;
    const label = feature.label as string;
    const detail = feature.detail as string;
    return [
      `              <li`,
      `                class={hoveredFeature === '${key}' ? 'highlighted' : ''}`,
      `                onmouseenter={() => (hoveredFeature = '${key}')}`,
      `                onmouseleave={() => (hoveredFeature = null)}`,
      `              >`,
      `                <strong>${label}:</strong>`,
      `                ${detail}`,
      `              </li>`
    ].join('\n');
  })
  .join('\n');

const total = defaultTutorialSteps.length;

let svelte = '';
svelte += `<!-- This file is generated by bin/buildTutorial.ts. Do not edit by hand. -->\n`;
svelte += `<script module lang="ts">\n`;
svelte += `  import type { FeatureKey } from '$lib/components/DemoMarketCard.svelte';\n\n`;
svelte += `  export type FeatureDescription = {\n`;
svelte += `    key: FeatureKey;\n`;
svelte += `    label: string;\n`;
svelte += `    detail: string;\n`;
svelte += `  };\n`;
svelte += `</script>\n\n`;

svelte += `<script lang="ts">\n`;
svelte += `  'use runes';\n\n`;
svelte += `  import DemoMarketCard from '$lib/components/DemoMarketCard.svelte';\n`;
svelte += `  import MarketCard, { type Market } from '$lib/components/MarketCard.svelte';\n\n`;
svelte += `  const { open = false, onClose, onComplete } = $props<{\n`;
svelte += `    open: boolean;\n`;
svelte += `    onClose?: () => void;\n`;
svelte += `    onComplete?: () => void;\n`;
svelte += `  }>();\n`;
svelte += `  const total = ${total};\n\n`;
svelte += `  const b = 40; // LMSR liquidity\n`;
svelte += `  const baseYes = 50;\n`;
svelte += `  const baseNo = 50;\n\n`;
svelte += `  let index = $state(0);\n`;
svelte += `  let completed = $state(false);\n`;
svelte += `  let resolved = $state(false);\n`;
svelte += `  let hoveredFeature = $state<FeatureKey | null>(null);\n\n`;
svelte += `  let yesBuy = $state<number>(0);\n`;
svelte += `  let noBuy = $state<number>(0);\n\n`;
svelte += `  const mockMarket: Market = {\n`;
svelte += `    title: 'Will Apple release a foldable iPhone in 2025?',\n`;
svelte += `    yes: 62,\n`;
svelte += `    no: 38,\n`;
svelte += `    community: '1,842 predictions',\n`;
svelte += `    resolves: 'Oct 9 · Apple Event',\n`;
svelte += `    trend: 12,\n`;
svelte += `    liquidity: 'deep',\n`;
svelte += `    category: 'Tech',\n`;
svelte += `    sparkline: '0,20 10,18 20,16 30,12 40,15 50,10 60,12 70,9 80,11 90,7 100,10 110,6 120,9'\n`;
svelte += `  };\n\n`;
svelte += `  const priceYes = $derived(toCents(priceLmsr(baseYes + yesBuy, baseNo + noBuy)));\n`;
svelte += `  const priceNo = $derived(100 - priceYes);\n`;
svelte += `  const displayedMarket = $derived(\n`;
svelte += `    resolved ? { ...mockMarket, yes: 100, no: 0 } : { ...mockMarket, yes: priceYes, no: priceNo }\n`;
svelte += `  );\n`;
svelte += `  const costYes = $derived(tradeCost(yesBuy, 0));\n`;
svelte += `  const costNo = $derived(tradeCost(0, noBuy));\n`;
svelte += `  const activeSide = $derived(yesBuy > 0 ? 'yes' : noBuy > 0 ? 'no' : null);\n`;
svelte += `  const shareCost = $derived(\n`;
svelte += `    yesBuy > 0\n`;
svelte += `      ? Number(((yesBuy * priceYes) / 100).toFixed(2))\n`;
svelte += `      : noBuy > 0\n`;
svelte += `        ? Number(((noBuy * priceNo) / 100).toFixed(2))\n`;
svelte += `        : 0\n`;
svelte += `  );\n`;
svelte += `  const payoutYes = $derived(Number((yesBuy * 1).toFixed(2)));\n`;
svelte += `  const netProfit = $derived(resolved ? Number((payoutYes - shareCost).toFixed(2)) : 0);\n`;
svelte += `  const netProfitPercent = $derived(\n`;
svelte += `    resolved && shareCost > 0 ? Number(((netProfit / shareCost) * 100).toFixed(2)) : 0\n`;
svelte += `  );\n`;
svelte += `  const payoutPositive = $derived(payoutYes > 0);\n\n`;
svelte += `  $effect(() => {\n`;
svelte += `    if (!open) {\n`;
svelte += `      index = 0;\n`;
svelte += `      completed = false;\n`;
svelte += `      resolved = false;\n`;
svelte += `      yesBuy = 0;\n`;
svelte += `      noBuy = 0;\n`;
svelte += `      hoveredFeature = null;\n`;
svelte += `    }\n`;
svelte += `  });\n\n`;
svelte += `  function close() {\n`;
svelte += `    index = 0;\n`;
svelte += `    completed = false;\n`;
svelte += `    onClose?.();\n`;
svelte += `  }\n\n`;
svelte += `  function next() {\n`;
svelte += `    if (index < total - 1) {\n`;
svelte += `      index += 1;\n`;
svelte += `    } else {\n`;
svelte += `      completed = true;\n`;
svelte += `      onComplete?.();\n`;
svelte += `    }\n`;
svelte += `  }\n\n`;
svelte += `  function back() {\n`;
svelte += `    if (index === 0) return;\n`;
svelte += `    index = Math.max(0, index - 1);\n`;
svelte += `  }\n\n`;
svelte += `  function resolveMarket() {\n`;
svelte += `    if (resolved) return;\n`;
svelte += `    resolved = true;\n`;
svelte += `  }\n\n`;
svelte += `  function resetResolution() {\n`;
svelte += `    if (!resolved) return;\n`;
svelte += `    resolved = false;\n`;
svelte += `  }\n\n`;
svelte += `  function priceLmsr(qYes: number, qNo: number) {\n`;
svelte += `    const expYes = Math.exp(qYes / b);\n`;
svelte += `    const expNo = Math.exp(qNo / b);\n`;
svelte += `    return expYes / (expYes + expNo);\n`;
svelte += `  }\n\n`;
svelte += `  function toCents(value: number) {\n`;
svelte += `    return Math.round(value * 100);\n`;
svelte += `  }\n\n`;
svelte += `  function cost(qYes: number, qNo: number) {\n`;
svelte += `    return b * Math.log(Math.exp(qYes / b) + Math.exp(qNo / b));\n`;
svelte += `  }\n\n`;
svelte += `  function tradeCost(deltaYes: number, deltaNo: number) {\n`;
svelte += `    const before = cost(baseYes, baseNo);\n`;
svelte += `    const after = cost(baseYes + deltaYes, baseNo + deltaNo);\n`;
svelte += `    return Math.max(0, after - before);\n`;
svelte += `  }\n\n`;
svelte += `  function handleYesInput(event: Event) {\n`;
svelte += `    const value = Number((event.currentTarget as HTMLInputElement).value);\n`;
svelte += `    yesBuy = value;\n`;
svelte += `    noBuy = 0;\n`;
svelte += `  }\n\n`;
svelte += `  function handleNoInput(event: Event) {\n`;
svelte += `    const value = Number((event.currentTarget as HTMLInputElement).value);\n`;
svelte += `    noBuy = value;\n`;
svelte += `    yesBuy = 0;\n`;
svelte += `  }\n`;
svelte += `</script>\n\n`;

svelte += `<div\n`;
svelte += `  class={open ? 'overlay overlay--open' : 'overlay overlay--hidden'}\n`;
svelte += `  role="dialog"\n`;
svelte += `  aria-modal="true"\n`;
svelte += `  aria-label="SocialPredict tutorial"\n`;
svelte += `>\n`;
svelte += `  <div class="modal">\n`;
svelte += `    <button class="close" aria-label="Close tutorial" type="button" onclick={close}>✕</button>\n\n`;
svelte += `    {#if !completed}\n`;
svelte += `      <div class="layout">\n`;
svelte += `        <div class="instructions">\n`;
svelte += `          <div class="eyebrow">Step {index + 1} of {total}</div>\n`;

//
// Inline per-step instructions
//
svelte += `          {#if index === 0}\n`;
svelte += `            <h3 class="demo-title">{@html ${step0Title}}</h3>\n`;
svelte += `            <p>{@html ${step0Desc}}</p>\n`;
if (step0.note) {
  svelte += `            <div class="note">{@html ${step0Note}}</div>\n`;
}
svelte += `          {:else if index === 1}\n`;
svelte += `            <h3 class="demo-title">{@html ${step1Title}}</h3>\n`;
if (step1.note) {
  svelte += `            <div class="note">{@html ${step1Note}}</div>\n`;
}
svelte += `            <ul class="feature-list">\n`;
svelte += featureItems + '\n';
svelte += `            </ul>\n`;
svelte += `          {:else if index === 2}\n`;
svelte += `            <h3 class="demo-title">{@html ${step2Title}}</h3>\n`;
svelte += `            <p>{@html ${step2Desc}}</p>\n`;
if (step2.note) {
  svelte += `            <div class="note">{@html ${step2Note}}</div>\n`;
}
svelte += `          {:else if index === 3}\n`;
svelte += `            <h3 class="demo-title">{@html ${step3Title}}</h3>\n`;
svelte += `            <p>{@html ${step3Desc}}</p>\n`;
if (step3.note) {
  svelte += `            <div class="note">{@html ${step3Note}}</div>\n`;
}
svelte += `          {:else}\n`;
svelte += `            <h3 class="demo-title">{@html ${step4Title}}</h3>\n`;
svelte += `            <p>{@html ${step4Desc}}</p>\n`;
if (step4.note) {
  svelte += `            <div class="note">{@html ${step4Note}}</div>\n`;
}
svelte += `          {/if}\n`;

svelte += `        </div>\n\n`;
svelte += `        <div class="demo">\n`;
svelte += `          <div class="demo__label">Mock market</div>\n`;
svelte += `          <div\n`;
svelte += `            class={resolved ? 'card-shell resolved' : 'card-shell'}\n`;
svelte += `            role="presentation"\n`;
svelte += `            onmouseleave={() => (hoveredFeature = null)}\n`;
svelte += `          >\n`;
svelte += `            <DemoMarketCard\n`;
svelte += `              market={displayedMarket}\n`;
svelte += `              highlightFeature={index === 1 ? hoveredFeature : null}\n`;
svelte += `              onFeatureHover={(key) => (hoveredFeature = key)}\n`;
svelte += `            />\n`;
svelte += `            {#if resolved}\n`;
svelte += `              <div class="resolved-badge">Resolved</div>\n`;
svelte += `            {/if}\n`;
svelte += `          </div>\n\n`;
svelte += `          {#if index === 2}\n`;
svelte += `            <div class="sliders">\n`;
svelte += `              <div class="slider-row">\n`;
svelte += `                <div class="slider-meta">\n`;
svelte += `                  <div class="tag yes">YES</div>\n`;
svelte += `                  <div class="value">{yesBuy} shares</div>\n`;
svelte += `                </div>\n`;
svelte += `                <input\n`;
svelte += `                  type="range"\n`;
svelte += `                  min="0"\n`;
svelte += `                  max="100"\n`;
svelte += `                  step="1"\n`;
svelte += `                  value={yesBuy}\n`;
svelte += `                  oninput={handleYesInput}\n`;
svelte += `                />\n`;
svelte += `              </div>\n`;
svelte += `              <div class="slider-row">\n`;
svelte += `                <div class="slider-meta">\n`;
svelte += `                  <div class="tag no">NO</div>\n`;
svelte += `                  <div class="value">{noBuy} shares</div>\n`;
svelte += `                </div>\n`;
svelte += `                <input\n`;
svelte += `                  type="range"\n`;
svelte += `                  min="0"\n`;
svelte += `                  max="100"\n`;
svelte += `                  step="1"\n`;
svelte += `                  value={noBuy}\n`;
svelte += `                  oninput={handleNoInput}\n`;
svelte += `                />\n`;
svelte += `              </div>\n`;
svelte += `              <div class="pill">\n`;
svelte += `                <span>Cost</span>\n`;
svelte += `                {#if activeSide === 'yes'}\n`;
svelte += `                  <span>Cost to buy {yesBuy} shares YES: $ {costYes.toFixed(2)}</span>\n`;
svelte += `                {:else if activeSide === 'no'}\n`;
svelte += `                  <span>Cost to buy {noBuy} shares NO: $ {costNo.toFixed(2)}</span>\n`;
svelte += `                {:else}\n`;
svelte += `                  <span>Move a slider to see cost</span>\n`;
svelte += `                {/if}\n`;
svelte += `              </div>\n`;
svelte += `            </div>\n`;
svelte += `          {:else if index === 3}\n`;
svelte += `            <div class="resolve-box">\n`;
svelte += `              <div class="resolve-actions">\n`;
svelte += `                <button class="primary" type="button" onclick={resolveMarket} disabled={resolved}>\n`;
svelte += `                  {resolved ? 'Market is Resolved' : 'Resolve Market to YES'}\n`;
svelte += `                </button>\n`;
svelte += `                <button class="ghost" type="button" onclick={resetResolution} disabled={!resolved}>\n`;
svelte += `                  Reset resolution\n`;
svelte += `                </button>\n`;
svelte += `              </div>\n`;
svelte += `              <div class="resolve-meta">\n`;
svelte += `                <div>You own: {yesBuy} YES / {noBuy} NO</div>\n`;
svelte += `                {#if resolved}\n`;
svelte += `                  <div class="cost">What you paid for your shares: $ {shareCost.toFixed(2)}</div>\n`;
svelte += `                {/if}\n`;
svelte += `                <div class={payoutPositive ? 'payout up' : 'payout down'}>\n`;
svelte += `                  {#if resolved}\n`;
svelte += `                    <div>Your Payout: $ {payoutYes.toFixed(2)}</div>\n`;
svelte += `                    <div>\n`;
svelte += `                      Net {netProfit >= 0 ? 'profit' : 'loss'}: $ {netProfit.toFixed(2)} (\n`;
svelte += `                      {netProfitPercent}%\n`;
svelte += `                      )\n`;
svelte += `                    </div>\n`;
svelte += `                  {:else}\n`;
svelte += `                    <div>Adjust the sliders to explore potential outcomes.</div>\n`;
svelte += `                  {/if}\n`;
svelte += `                </div>\n`;
svelte += `              </div>\n`;
svelte += `            </div>\n`;
svelte += `          {/if}\n`;
svelte += `        </div>\n`;
svelte += `      </div>\n\n`;
svelte += `      <div class="progress">\n`;

// Static dots, no {#each}
for (let i = 0; i < total; i++) {
  svelte += `        <div class={index === ${i} ? 'dot active' : 'dot'}></div>\n`;
}

svelte += `      </div>\n\n`;
svelte += `      <div class="actions">\n`;
svelte += `        {#if index > 0}\n`;
svelte += `          <button class="secondary ghost" type="button" onclick={back}>Back</button>\n`;
svelte += `        {/if}\n`;
svelte += `        <button class="primary" type="button" onclick={next}>\n`;
svelte += `          {index === total - 1 ? 'Finish' : 'Next'}\n`;
svelte += `        </button>\n`;
svelte += `      </div>\n`;
svelte += `    {:else}\n`;
svelte += `      <div class="layout">\n`;
svelte += `        <div class="instructions">\n`;
svelte += `          <div class="header">\n`;
svelte += `            <div class="eyebrow">Ready to trade?</div>\n`;
svelte += `            <h3>Join the SocialPredict crowd</h3>\n`;
svelte += `            <p>\n`;
svelte += `              You just walked through how to place a YES/NO order. Create an account to follow\n`;
svelte += `              forecasters, join threads, and start predicting live markets.\n`;
svelte += `            </p>\n`;
svelte += `          </div>\n`;
svelte += `          <div class="cta-row single">\n`;
svelte += `            <button class="primary" type="button">Create Account</button>\n`;
svelte += `          </div>\n`;
svelte += `        </div>\n`;
svelte += `      </div>\n`;
svelte += `      <div class="actions">\n`;
svelte += `        <button class="secondary" type="button" onclick={close}>Close</button>\n`;
svelte += `      </div>\n`;
svelte += `    {/if}\n`;
svelte += `  </div>\n`;
svelte += `</div>\n\n`;

// Styles (same as branded TutorialModal; uses CSS vars)
svelte += `<style>\n`;
svelte += `  .overlay {\n`;
svelte += `    position: fixed;\n`;
svelte += `    inset: 0;\n`;
svelte += `    background: rgba(10, 11, 16, 0.65);\n`;
svelte += `    display: grid;\n`;
svelte += `    place-items: center;\n`;
svelte += `    z-index: 20;\n`;
svelte += `    padding: 1.5rem;\n`;
svelte += `    opacity: 1;\n`;
svelte += `    pointer-events: auto;\n`;
svelte += `    visibility: visible;\n`;
svelte += `    transition: opacity 150ms ease-out, visibility 150ms ease-out;\n`;
svelte += `  }\n\n`;
svelte += `  .overlay.overlay--hidden {\n`;
svelte += `    opacity: 0;\n`;
svelte += `    pointer-events: none;\n`;
svelte += `    visibility: hidden;\n`;
svelte += `  }\n\n`;
svelte += `  .modal {\n`;
svelte += `    position: relative;\n`;
svelte += `    width: min(78vw, 1100px);\n`;
svelte += `    min-height: 60vh;\n`;
svelte += `    padding: 1.6rem 1.9rem;\n`;
svelte += `    border-radius: 1.2rem;\n`;
svelte += `    background: var(--panel, #12131a);\n`;
svelte += `    border: 1px solid var(--border, rgba(255, 255, 255, 0.1));\n`;
svelte += `    box-shadow: 0 20px 50px rgba(0, 0, 0, 0.45),\n`;
svelte += `      0 0 0 1px var(--color-primary-soft, rgba(159, 107, 255, 0.18));\n`;
svelte += `    display: grid;\n`;
svelte += `    gap: 1.2rem;\n`;
svelte += `  }\n\n`;
svelte += `  .layout {\n`;
svelte += `    display: grid;\n`;
svelte += `    grid-template-columns: 1fr 1fr;\n`;
svelte += `    gap: 1.2rem;\n`;
svelte += `    align-items: start;\n`;
svelte += `  }\n\n`;
svelte += `  .close {\n`;
svelte += `    position: absolute;\n`;
svelte += `    top: 0.8rem;\n`;
svelte += `    right: 0.8rem;\n`;
svelte += `    background: var(--panel, rgba(255, 255, 255, 0.05));\n`;
svelte += `    border: 1px solid var(--border, rgba(255, 255, 255, 0.12));\n`;
svelte += `    color: var(--text, #e6e4ff);\n`;
svelte += `    border-radius: 50%;\n`;
svelte += `    width: 36px;\n`;
svelte += `    height: 36px;\n`;
svelte += `    cursor: pointer;\n`;
svelte += `    font-size: 1rem;\n`;
svelte += `  }\n\n`;
svelte += `  .instructions {\n`;
svelte += `    display: grid;\n`;
svelte += `    gap: 0.75rem;\n`;
svelte += `    align-content: start;\n`;
svelte += `  }\n\n`;
svelte += `  .header {\n`;
svelte += `    display: grid;\n`;
svelte += `    gap: 0.35rem;\n`;
svelte += `  }\n\n`;
svelte += `  .eyebrow {\n`;
svelte += `    display: inline-flex;\n`;
svelte += `    align-items: center;\n`;
svelte += `    gap: 0.4rem;\n`;
svelte += `    padding: 0.35rem 0.7rem;\n`;
svelte += `    border-radius: 999px;\n`;
svelte += `    text-transform: uppercase;\n`;
svelte += `    letter-spacing: 0.08em;\n`;
svelte += `    font-size: 0.78rem;\n`;
svelte += `    color: var(--color-primary, #9f6bff);\n`;
svelte += `    background: var(--color-primary-soft, rgba(159, 107, 255, 0.14));\n`;
svelte += `    border: 1px solid color-mix(in srgb, var(--color-primary, #9f6bff) 55%, transparent);\n`;
svelte += `    width: fit-content;\n`;
svelte += `  }\n\n`;
svelte += `  h3 {\n`;
svelte += `    margin: 0.1rem 0 0;\n`;
svelte += `    color: var(--text, #f7f6ff);\n`;
svelte += `  }\n\n`;
svelte += `  .demo-title {\n`;
svelte += `    margin: 0.1rem 0 0;\n`;
svelte += `    color: var(--text, #f7f6ff);\n`;
svelte += `    font-weight: 900;\n`;
svelte += `  }\n\n`;
svelte += `  p {\n`;
svelte += `    margin: 0;\n`;
svelte += `    color: var(--text-subtle, #c4c8df);\n`;
svelte += `  }\n\n`;
svelte += `  .spaced {\n`;
svelte += `    margin-bottom: 1rem;\n`;
svelte += `  }\n\n`;
svelte += `  .note {\n`;
svelte += `    margin-top: 0.3rem;\n`;
svelte += `    padding: 0.65rem 0.8rem;\n`;
svelte += `    border-radius: 0.75rem;\n`;
svelte += `    background: var(--panel, rgba(255, 255, 255, 0.04));\n`;
svelte += `    border: 1px dashed var(--border, rgba(255, 255, 255, 0.12));\n`;
svelte += `    color: var(--text, #e6e4ff);\n`;
svelte += `  }\n\n`;
svelte += `  .progress {\n`;
svelte += `    display: flex;\n`;
svelte += `    gap: 0.4rem;\n`;
svelte += `  }\n\n`;
svelte += `  .dot {\n`;
svelte += `    width: 12px;\n`;
svelte += `    height: 12px;\n`;
svelte += `    border-radius: 50%;\n`;
svelte += `    background: rgba(255, 255, 255, 0.12);\n`;
svelte += `    border: 1px solid rgba(255, 255, 255, 0.1);\n`;
svelte += `  }\n\n`;
svelte += `  .dot.active {\n`;
svelte += `    background: linear-gradient(\n`;
svelte += `      135deg,\n`;
svelte += `      var(--color-primary, #6a3ff5),\n`;
svelte += `      var(--color-accent, #35e2d1)\n`;
svelte += `    );\n`;
svelte += `    box-shadow: 0 0 12px color-mix(in srgb, var(--color-primary, #6a3ff5) 60%, transparent);\n`;
svelte += `  }\n\n`;
svelte += `  .actions {\n`;
svelte += `    display: flex;\n`;
svelte += `    justify-content: flex-end;\n`;
svelte += `    gap: 0.7rem;\n`;
svelte += `    align-items: center;\n`;
svelte += `  }\n\n`;
svelte += `  .demo {\n`;
svelte += `    display: grid;\n`;
svelte += `    gap: 0.75rem;\n`;
svelte += `    align-content: start;\n`;
svelte += `  }\n\n`;
svelte += `  .demo__label {\n`;
svelte += `    font-size: 0.9rem;\n`;
svelte += `    color: var(--text-subtle, #c4c8df);\n`;
svelte += `    text-transform: uppercase;\n`;
svelte += `    letter-spacing: 0.08em;\n`;
svelte += `  }\n\n`;
svelte += `  .feature-list {\n`;
svelte += `    list-style: disc;\n`;
svelte += `    padding-left: 1.3rem;\n`;
svelte += `    display: grid;\n`;
svelte += `    gap: 0.5rem;\n`;
svelte += `    color: var(--text, #dcd9f4);\n`;
svelte += `  }\n\n`;
svelte += `  .feature-list li {\n`;
svelte += `    list-style: disc;\n`;
svelte += `  }\n\n`;
svelte += `  .feature-list li.highlighted {\n`;
svelte += `    color: var(--color-accent, #35e2d1);\n`;
svelte += `    text-shadow: 0 0 10px color-mix(in srgb, var(--color-accent, #35e2d1) 55%, transparent);\n`;
svelte += `  }\n\n`;
svelte += `  .feature-list strong {\n`;
svelte += `    color: var(--text, #f7f6ff);\n`;
svelte += `  }\n\n`;
svelte += `  .sliders {\n`;
svelte += `    display: grid;\n`;
svelte += `    gap: 0.85rem;\n`;
svelte += `    margin-top: 0.5rem;\n`;
svelte += `  }\n\n`;
svelte += `  .slider-row {\n`;
svelte += `    display: grid;\n`;
svelte += `    gap: 0.35rem;\n`;
svelte += `  }\n\n`;
svelte += `  .slider-meta {\n`;
svelte += `    display: flex;\n`;
svelte += `    justify-content: space-between;\n`;
svelte += `    align-items: center;\n`;
svelte += `    color: var(--text, #e6e4ff);\n`;
svelte += `    font-weight: 700;\n`;
svelte += `  }\n\n`;
svelte += `  .slider-row input[type='range'] {\n`;
svelte += `    accent-color: var(--color-primary, #6a3ff5);\n`;
svelte += `  }\n\n`;
svelte += `  .slider-row input[type='range']::-webkit-slider-thumb {\n`;
svelte += `    box-shadow: 0 0 0 6px color-mix(in srgb, var(--color-primary, #6a3ff5) 35%, transparent);\n`;
svelte += `  }\n\n`;
svelte += `  .tag {\n`;
svelte += `    padding: 0.25rem 0.6rem;\n`;
svelte += `    border-radius: 0.7rem;\n`;
svelte += `    font-size: 0.85rem;\n`;
svelte += `    text-transform: uppercase;\n`;
svelte += `    letter-spacing: 0.05em;\n`;
svelte += `  }\n\n`;
svelte += `  .tag.yes {\n`;
svelte += `    background: var(--color-accent-soft, rgba(53, 226, 209, 0.14));\n`;
svelte += `    color: var(--color-accent, #35e2d1);\n`;
svelte += `    border: 1px solid color-mix(in srgb, var(--color-accent, #35e2d1) 55%, transparent);\n`;
svelte += `  }\n\n`;
svelte += `  .tag.no {\n`;
svelte += `    background: var(--color-danger-soft, rgba(255, 111, 97, 0.12));\n`;
svelte += `    color: var(--color-danger, #ff8d7f);\n`;
svelte += `    border: 1px solid color-mix(in srgb, var(--color-danger, #ff8d7f) 55%, transparent);\n`;
svelte += `  }\n\n`;
svelte += `  .pill {\n`;
svelte += `    display: flex;\n`;
svelte += `    justify-content: space-between;\n`;
svelte += `    align-items: center;\n`;
svelte += `    padding: 0.75rem 0.9rem;\n`;
svelte += `    border-radius: 0.85rem;\n`;
svelte += `    background: var(--panel, rgba(255, 255, 255, 0.04));\n`;
svelte += `    border: 1px solid var(--border, rgba(255, 255, 255, 0.08));\n`;
svelte += `    font-weight: 700;\n`;
svelte += `    color: var(--text, #f4f1ff);\n`;
svelte += `  }\n\n`;
svelte += `  .cta-row {\n`;
svelte += `    display: flex;\n`;
svelte += `    gap: 0.75rem;\n`;
svelte += `  }\n\n`;
svelte += `  .cta-row.single {\n`;
svelte += `    justify-content: flex-start;\n`;
svelte += `  }\n\n`;
svelte += `  .card-shell {\n`;
svelte += `    position: relative;\n`;
svelte += `  }\n\n`;
svelte += `  .resolved .resolved-badge {\n`;
svelte += `    display: inline-flex;\n`;
svelte += `    align-items: center;\n`;
svelte += `    gap: 0.35rem;\n`;
svelte += `    padding: 0.35rem 0.7rem;\n`;
svelte += `    border-radius: 0.9rem;\n`;
svelte += `    background: var(--color-accent-soft, rgba(53, 226, 209, 0.18));\n`;
svelte += `    color: var(--text, #e6e4ff);\n`;
svelte += `    font-weight: 800;\n`;
svelte += `    position: absolute;\n`;
svelte += `    top: 0.75rem;\n`;
svelte += `    right: 0.75rem;\n`;
svelte += `    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.25);\n`;
svelte += `  }\n\n`;
svelte += `  .resolve-box {\n`;
svelte += `    display: grid;\n`;
svelte += `    gap: 0.55rem;\n`;
svelte += `    align-content: start;\n`;
svelte += `  }\n\n`;
svelte += `  .resolve-actions {\n`;
svelte += `    display: flex;\n`;
svelte += `    flex-wrap: wrap;\n`;
svelte += `    gap: 0.5rem;\n`;
svelte += `  }\n\n`;
svelte += `  .resolve-box .primary {\n`;
svelte += `    width: fit-content;\n`;
svelte += `  }\n\n`;
svelte += `  .resolve-meta {\n`;
svelte += `    display: grid;\n`;
svelte += `    gap: 0.2rem;\n`;
svelte += `    color: var(--text-subtle, #dcd9f4);\n`;
svelte += `    font-weight: 700;\n`;
svelte += `  }\n\n`;
svelte += `  .cost {\n`;
svelte += `    color: var(--text-muted, #a9aec9);\n`;
svelte += `  }\n\n`;
svelte += `  .payout.up {\n`;
svelte += `    color: var(--color-accent, #35e2d1);\n`;
svelte += `  }\n\n`;
svelte += `  .payout.down {\n`;
svelte += `    color: var(--color-danger, #ff8d7f);\n`;
svelte += `  }\n\n`;
svelte += `  button.primary,\n`;
svelte += `  button.secondary,\n`;
svelte += `  button.ghost {\n`;
svelte += `    padding: 0.85rem 1.2rem;\n`;
svelte += `    border-radius: 0.95rem;\n`;
svelte += `    font-weight: 800;\n`;
svelte += `    font-size: 1rem;\n`;
svelte += `    letter-spacing: 0.01em;\n`;
svelte += `    border: none;\n`;
svelte += `    cursor: pointer;\n`;
svelte += `  }\n\n`;
svelte += `  button.primary {\n`;
svelte += `    background: linear-gradient(\n`;
svelte += `      135deg,\n`;
svelte += `      var(--color-primary, #6a3ff5),\n`;
svelte += `      var(--color-accent, #9f6bff)\n`;
svelte += `    );\n`;
svelte += `    color: var(--color-text-light, #e6e4ff);\n`;
svelte += `    box-shadow: 0 14px 36px color-mix(in srgb, var(--color-primary, #6a3ff5) 45%, transparent);\n`;
svelte += `  }\n\n`;
svelte += `  button.secondary {\n`;
svelte += `    background: var(--panel, rgba(255, 255, 255, 0.06));\n`;
svelte += `    color: var(--text, #e6e4ff);\n`;
svelte += `    border: 1px solid var(--border, rgba(255, 255, 255, 0.1));\n`;
svelte += `  }\n\n`;
svelte += `  button.ghost {\n`;
svelte += `    background: transparent;\n`;
svelte += `    color: var(--text, #e6e4ff);\n`;
svelte += `    border: 1px solid var(--border, rgba(255, 255, 255, 0.14));\n`;
svelte += `  }\n\n`;
svelte += `  button:disabled {\n`;
svelte += `    opacity: 0.5;\n`;
svelte += `    cursor: not-allowed;\n`;
svelte += `    box-shadow: none;\n`;
svelte += `  }\n\n`;
svelte += `  button.primary:hover {\n`;
svelte += `    transform: translateY(-1px);\n`;
svelte += `  }\n\n`;
svelte += `  button.secondary:hover,\n`;
svelte += `  button.ghost:hover {\n`;
svelte += `    border-color: color-mix(\n`;
svelte += `      in srgb,\n`;
svelte += `      var(--color-primary, #6a3ff5) 65%,\n`;
svelte += `      var(--border, #4b5563) 35%\n`;
svelte += `    );\n`;
svelte += `  }\n\n`;
svelte += `  @media (max-width: 900px) {\n`;
svelte += `    .modal {\n`;
svelte += `      width: min(95vw, 760px);\n`;
svelte += `    }\n\n`;
svelte += `    .layout {\n`;
svelte += `      grid-template-columns: 1fr;\n`;
svelte += `    }\n\n`;
svelte += `    .cta-row {\n`;
svelte += `      flex-direction: column;\n`;
svelte += `    }\n\n`;
svelte += `    .actions {\n`;
svelte += `      flex-direction: column;\n`;
svelte += `      align-items: stretch;\n`;
svelte += `    }\n\n`;
svelte += `    .actions button {\n`;
svelte += `      width: 100%;\n`;
svelte += `    }\n`;
svelte += `  }\n`;
svelte += `</style>\n`;

fs.mkdirSync(path.dirname(outPath), { recursive: true });
fs.writeFileSync(outPath, svelte, 'utf8');
console.log(`Wrote ${outPath}`);
