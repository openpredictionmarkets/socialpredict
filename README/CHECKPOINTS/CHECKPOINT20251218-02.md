SRP Issues

handlers/cms/homepage/service.go (lines 13-79) – The Renderer interface and its DefaultRenderer implementation own two unrelated responsibilities: Markdown conversion (MarkdownToHTML) and HTML sanitization (SanitizeHTML). A change in sanitization policy (allowed attributes, accessibility requirements) should not force a change in the Markdown renderer, and vice versa. Because the interface couples both behaviors, every consumer must depend on both, and any change to either concern requires touching this same type. Splitting these into discrete abstractions (e.g., MarkupRenderer and HTMLSanitizer) would keep the reasons to change independent.

handlers/cms/homepage/service.go (lines 104-137) – Service.UpdateHome is a “do everything” method: it reads the record (GetBySlug), enforces optimistic locking, mutates metadata fields, branches on presentation formats, renders Markdown, sanitizes HTML, performs format-specific cleanup, and finally saves the record. Each of these steps has its own reason to change (repository contract, locking rules, domain field mapping, Markdown rendering rules, sanitization policy, persistence). Because they are all fused into one function, any adjustment to any concern requires editing UpdateHome, and the method needs tests that mix business logic, formatting, and persistence. Extracting discrete collaborators (e.g., a version/locking guard, a formatter/renderer service, and a persistence wrapper) would bring the method back in line with SRP.