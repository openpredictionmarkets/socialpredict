## ChatGPT Codex review of /internal/domain/users/service.go

### Cross-Domain Responsibilities

* backend/internal/domain/users/service.go (lines 13-27) – ServiceInterface is a “god interface”; it mixes CRUD, market participation, analytics, profile editing, credit/ledger ops, and password management, so the user service must change whenever any of those unrelated concerns evolve.

* backend/internal/domain/users/service.go (lines 30-44) – Repository reaches into markets (GetMarketQuestion, GetUserPositionInMarket, ListUserMarkets) and authentication data (GetCredentials, UpdatePassword) in addition to user persistence, so repository changes in those domains ripple straight into the user service.

* backend/internal/domain/users/service.go (lines 92-239) – functions such as ValidateUserBalance, DeductBalance, ApplyTransaction, and GetUserCredit perform balance bookkeeping and transaction policy decisions; those finance rules are a distinct responsibility from basic user management, giving the struct a second reason to change whenever accounting logic shifts.

* backend/internal/domain/users/service.go (lines 241-300) – GetUserPortfolio and ListUserMarkets deeply understand betting history, market questions, and sorting logic; market/portfolio behavior changes would force edits to the same service that already owns CRUD and finance.

* backend/internal/domain/users/service.go (lines 302-325) and 467-485 – GetUserFinancials plus financialSnapshotToMap adapt analytics-layer DTOs and data shape decisions, so analytics format changes also modify this file.

### Data Hygiene & Presentation

* backend/internal/domain/users/service.go (lines 124-144) and 488-518 – constructing bespoke public/private DTOs lives alongside business logic; any change to presentation needs results, not to core orchestration, would still require touching this service.

* backend/internal/domain/users/service.go (lines 146-189) – CreateUser/UpdateUser encode defaulting behavior and field-mapping rules; alterations to request/response mapping would change the same type that already handles finance, markets, and security.

* backend/internal/domain/users/service.go (lines 327-409) – UpdateDescription, UpdateDisplayName, and UpdateEmoji enforce length rules, error messaging, and sanitizer invocation, so UX-driven copy/rules updates force changes mixed with unrelated concerns.

* backend/internal/domain/users/service.go (lines 411-465) – UpdatePersonalLinks owns both persistence and iterative sanitization/validation logic (sanitizePersonalLinks), yet link format policy is a separate concern from user orchestration.

### Credentials & Security

* backend/internal/domain/users/service.go (lines 53-60) and 327-373 – the sanitizer dependency spans both profile text and passwords; tightening password policy or profile rules implicates the same service even though those responsibilities differ.

* backend/internal/domain/users/service.go (lines 520-525) – exporting PasswordHashCost places hashing-parameter decisions in the user service; security policy changes therefore force edits here.

* backend/internal/domain/users/service.go (lines 527-541) – validatePasswordChangeInputs encodes UI-level validation rules for password workflows, another reason to change unrelated to CRUD or finance.

* backend/internal/domain/users/service.go (lines 544-573) – ChangePassword handles authentication (credential retrieval, password comparison, reuse prevention, bcrypt hashing) instead of delegating to an auth module, so any security change (hash algorithm, comparison semantics) again hits this already overcrowded service.

Natural next steps: 1) split the god interface/service into focused packages for identity/profile, ledger/credit, market participation, analytics snapshots, and credentials; 2) move sanitizer/business-rule code behind dedicated collaborators so presentation or security policy shifts don’t force changes in the core user orchestration.