# Extracting Auth from "God Interface"

## Claude's Summary

  Key changes:

  1. AuthService expanded (internal/service/auth/auth_service.go):
    - Added ChangePassword and MustChangePassword to the Authenticator interface
    - Defined narrow interfaces: UserReader, CredentialRepository, PasswordSanitizer
    - NewAuthService now takes 3 args instead of the full ServiceInterface
    - AuthService now owns bcrypt password hashing, credential validation, and password-change enforcement
  2. users.ServiceInterface shrunk from 14 → 12 methods:
    - Removed ChangePassword and MustChangePassword
    - Removed bcrypt and auth imports from service.go
  3. users.Repository cleaned up:
    - Removed GetCredentials and UpdatePassword (now only used via CredentialRepository)
    - Replaced with GetMustChangePasswordFlag (returns bool, no auth package dependency)
  4. 9 handlers converted from package-level auth functions to Authenticator interface:
    - changepassword.go — now takes only Authenticator (no users service needed)
    - changedisplayname.go, changedescription.go, changeemoji.go, changepersonallinks.go — added auth param
    - privateuser.go — added auth param
    - userpositiononmarkethandler.go — replaced usersSvc with auth
    - buypositionhandler.go, sellpositionhandler.go — replaced usersSvc with auth
  5. All tests pass (except pre-existing balance_integration_test.go failure unrelated to this work).

  Human to-dos from Osnat:

  - Let's figure out what to do next!
  - Let's audit Claude Opus work: see if it fits the style guide, reduces code spaghetti, etc.
  - Let's work on the wallet/account package as defined in the checkpoint from 5 Feb 2026.
  