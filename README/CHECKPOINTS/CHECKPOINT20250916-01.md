Here's a project outline that should solve this.

Project: Deterministic Vite allowedHosts Integration with Deploy Scripts
Objective

Update SocialPredict’s frontend build system so that Vite’s server.allowedHosts and preview.allowedHosts are automatically populated from the .env file and deploy scripts, rather than being hard-coded. This ensures:

Consistency: the same domain used in SSL certs and Nginx is also whitelisted in Vite.

Determinism: hostnames are set from .env and deploy scripts, not manually or via CLI flags.

Security: production stays locked down to the configured domain(s), while development has sensible defaults (localhost, 127.0.0.1, frontend).

Implementation Plan
1. Create a Vite Config Template

Add a new template file at frontend/vite.config.mjs.template:

// frontend/vite.config.mjs.template
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

// Parse comma-separated host lists from env
const parseHosts = (s) =>
  (s || '')
    .split(',')
    .map(h => h.trim())
    .filter(Boolean)

const DEV_ALLOWED = parseHosts(process.env.VITE_DEV_ALLOWED_HOSTS)
const PROD_ALLOWED = parseHosts(process.env.VITE_PROD_ALLOWED_HOSTS)

export default defineConfig(({ mode }) => {
  const isProd = mode === 'production'
  const allowed = isProd ? PROD_ALLOWED : DEV_ALLOWED

  return {
    server: {
      host: '0.0.0.0',
      allowedHosts: allowed.length ? allowed : ['localhost', '127.0.0.1', 'frontend'],
    },
    preview: {
      allowedHosts: allowed.length ? allowed : ['localhost'],
    },
    build: {
      outDir: 'build',
      commonjsOptions: { transformMixedEsModules: true },
    },
    plugins: [react()],
    css: {
      target: 'async',
    },
  }
})

2. Update Deploy Scripts to Stamp Template
prod/build_prod.sh

Add a function to generate vite.config.mjs:

frontend_vite_allowed_hosts() {
  local template="$SCRIPT_DIR/frontend/vite.config.mjs.template"
  local file="$SCRIPT_DIR/frontend/vite.config.mjs"

  # Ensure env vars are set
  export VITE_DEV_ALLOWED_HOSTS="${VITE_DEV_ALLOWED_HOSTS:-localhost,127.0.0.1,frontend}"
  export VITE_PROD_ALLOWED_HOSTS="${VITE_PROD_ALLOWED_HOSTS:-$DOMAIN,www.$DOMAIN}"

  envsubst < "$template" > "$file"
}

build_frontend() {
  echo "### Building Frontend Image ..."
  frontend_api_uri
  frontend_vite_allowed_hosts
  # existing build logic...
}

dev/build_dev.sh

Add a dev version:

frontend_vite_allowed_hosts_dev() {
  local template="$SCRIPT_DIR/frontend/vite.config.mjs.template"
  local file="$SCRIPT_DIR/frontend/vite.config.mjs"

  export VITE_DEV_ALLOWED_HOSTS="${VITE_DEV_ALLOWED_HOSTS:-localhost,127.0.0.1,frontend}"
  export VITE_PROD_ALLOWED_HOSTS="${VITE_PROD_ALLOWED_HOSTS:-}"

  envsubst < "$template" > "$file"
}

build_frontend() {
  echo "### Building Frontend Image ..."
  frontend_vite_allowed_hosts_dev
  # existing build logic...
}

3. Extend .env Creation
prod/env_writer_prod.sh

After setting DOMAIN, add:

# Add VITE_PROD_ALLOWED_HOSTS and VITE_DEV_ALLOWED_HOSTS if not present
if ! grep -q "^VITE_PROD_ALLOWED_HOSTS=" .env; then
  echo "VITE_PROD_ALLOWED_HOSTS='${domain_answer},www.${domain_answer}'" >> .env
fi

if ! grep -q "^VITE_DEV_ALLOWED_HOSTS=" .env; then
  echo "VITE_DEV_ALLOWED_HOSTS='localhost,127.0.0.1,frontend'" >> .env
fi

dev/env_writer_dev.sh

Append default dev hosts:

if ! grep -q "^VITE_DEV_ALLOWED_HOSTS=" "$SCRIPT_DIR/.env"; then
  echo "VITE_DEV_ALLOWED_HOSTS='localhost,127.0.0.1,frontend'" >> "$SCRIPT_DIR/.env"
fi

Result

.env deterministically defines which hosts are allowed.

Production automatically whitelists ${DOMAIN},www.${DOMAIN}.

Development defaults to localhost + Docker service name.

No need for ad-hoc CLI args or manual editing.

Next Steps

Implement the above changes in frontend/, scripts/prod/, and scripts/dev/.

Test locally: run ./SocialPredict dev and confirm Vite allows localhost + frontend.

Test prod: run ./SocialPredict prod, verify .env populates VITE_PROD_ALLOWED_HOSTS, and that the frontend only accepts traffic from your configured domain(s).