Here‚Äôs a drop-in CI setup that works for any Go version, without touching branch protection again.

What this does

Lets you declare Go versions outside the workflow:

Put them in .github/go-versions (one per line), e.g.:

file:backend/go.mod
1.26.x
1.25.x


If the file is absent, it defaults to a single lane that reads from your module‚Äôs go.mod (file:backend/go.mod), so it always follows whatever go 1.xx is in the repo.

Builds a dynamic matrix from that file at runtime (via actions/github-script).

Runs per-version unit jobs (unit_matrix) and reports a stable aggregate check named unit.

You only need to require Backend / unit (pull_request) in branch protection. No version churn, ever.

Copy-pasteable patch for Cline / Claude Code 4

Assumes your CI file is .github/workflows/backend.yml. If it‚Äôs a different name, just adjust the patch header path.

*** Begin Patch
*** Update File: .github/workflows/backend.yml
@@
 name: Backend
 
 on:
   pull_request:
     branches: [main]
   workflow_dispatch:
 
 concurrency:
   group: "linux-test"
   cancel-in-progress: true
 
 jobs:
+  # Prepare the Go version matrix dynamically.
+  # Source order of precedence:
+  # 1) .github/go-versions (if present)
+  # 2) Default to the module's go.mod (file:backend/go.mod)
+  prepare-matrix:
+    name: prepare-matrix
+    runs-on: ubuntu-latest
+    outputs:
+      matrix: ${{ steps.build.outputs.matrix }}
+    steps:
+      - uses: actions/checkout@v4
+      - id: build
+        name: Build Go version matrix JSON
+        uses: actions/github-script@v7
+        with:
+          script: |
+            const fs = require('fs');
+            const path = '.github/go-versions';
+            let entries = [];
+            if (fs.existsSync(path)) {
+              const raw = fs.readFileSync(path, 'utf8')
+                .split('\n')
+                .map(l => l.trim())
+                .filter(l => l && !l.startsWith('#'));
+              for (const line of raw) {
+                if (line.startsWith('file:')) {
+                  entries.push({ mode: 'file', value: line.replace(/^file:/,'') });
+                } else {
+                  entries.push({ mode: 'version', value: line });
+                }
+              }
+            } else {
+              // Default: follow the module version from backend/go.mod
+              entries = [{ mode: 'file', value: 'backend/go.mod' }];
+            }
+            const matrix = { go: entries };
+            core.setOutput('matrix', JSON.stringify(matrix));
 
   smoke:
     runs-on: ubuntu-latest
     strategy:
       fail-fast: false
-      matrix:
-        go-version: [ '1.25.x' ]
+      matrix:
+        go-version: [ '1.25.x' ]
     steps:
       - uses: actions/checkout@v4
       - name: Setup Go ${{ matrix.go-version }}
         uses: actions/setup-go@v5
         with:
           go-version: ${{ matrix.go-version }}
       - name: Get Dependencies
         working-directory: ./backend
         run: |
           go mod download
       - name: Run tests
         working-directory: ./backend
         run: |
           go build -o ./main && ./main &
           SERVER_PID=$!
           sleep 10
           kill $SERVER_PID
 
-  unit_go_123:
-    name: unit (1.23.x)
-    needs: smoke
-    if: |
-      startsWith(github.head_ref, 'feature/')
-      || startsWith(github.head_ref, 'fix/')
-      || startsWith(github.head_ref, 'refactor/')
-      || startsWith(github.head_ref, 'doc/')
-    runs-on: ubuntu-latest
-    steps:
-      - uses: actions/checkout@v4
-        if: ${{ !startsWith(github.head_ref, 'doc/') }}
-      - name: Setup Go 1.23.x
-        if: ${{ !startsWith(github.head_ref, 'doc/') }}
-        uses: actions/setup-go@v5
-        with:
-          go-version: "1.23.x"
-      - name: Get Dependencies
-        if: ${{ !startsWith(github.head_ref, 'doc/') }}
-        working-directory: ./backend
-        run: go get .
-      - name: Run tests (Go 1.23.x)
-        if: ${{ !startsWith(github.head_ref, 'doc/') }}
-        working-directory: ./backend
-        env:
-          JWT_SIGNING_KEY: "test-secret-key-for-testing"
-        run: go test ./...
-
-  unit_go_125:
-    name: unit (1.25.x)
-    needs: smoke
-    if: |
-      startsWith(github.head_ref, 'feature/')
-      || startsWith(github.head_ref, 'fix/')
-      || startsWith(github.head_ref, 'refactor/')
-      || startsWith(github.head_ref, 'doc/')
-    runs-on: ubuntu-latest
-    steps:
-      - uses: actions/checkout@v4
-        if: ${{ !startsWith(github.head_ref, 'doc/') }}
-      - name: Setup Go 1.25.x
-        if: ${{ !startsWith(github.head_ref, 'doc/') }}
-        uses: actions/setup-go@v5
-        with:
-          go-version: "1.25.x"
-      - name: Get Dependencies
-        if: ${{ !startsWith(github.head_ref, 'doc/') }}
-        working-directory: ./backend
-        run: go get .
-      - name: Run tests (Go 1.25.x)
-        if: ${{ !startsWith(github.head_ref, 'doc/') }}
-        working-directory: ./backend
-        env:
-          JWT_SIGNING_KEY: "test-secret-key-for-testing"
-        run: go test ./...
+  # Dynamic, ANY-version unit matrix (driven by prepare-matrix output)
+  unit_matrix:
+    name: unit (matrix)
+    needs: [smoke, prepare-matrix]
+    if: |
+      startsWith(github.head_ref, 'feature/')
+      || startsWith(github.head_ref, 'fix/')
+      || startsWith(github.head_ref, 'refactor/')
+      || startsWith(github.head_ref, 'doc/')
+    runs-on: ubuntu-latest
+    strategy:
+      fail-fast: false
+      matrix: ${{ fromJson(needs.prepare-matrix.outputs.matrix) }}
+    steps:
+      - uses: actions/checkout@v4
+        if: ${{ !startsWith(github.head_ref, 'doc/') }}
+      # Use go-version-file when mode == file, otherwise go-version
+      - name: Setup Go (from go.mod)
+        if: ${{ !startsWith(github.head_ref, 'doc/') && matrix.go.mode == 'file' }}
+        uses: actions/setup-go@v5
+        with:
+          go-version-file: ${{ matrix.go.value }}
+          check-latest: true
+          cache: 'gomod'
+      - name: Setup Go ${{ matrix.go.value }}
+        if: ${{ !startsWith(github.head_ref, 'doc/') && matrix.go.mode == 'version' }}
+        uses: actions/setup-go@v5
+        with:
+          go-version: ${{ matrix.go.value }}
+          check-latest: true
+          cache: 'gomod'
+      - name: Get Dependencies
+        if: ${{ !startsWith(github.head_ref, 'doc/') }}
+        working-directory: ./backend
+        run: go get .
+      - name: Run unit tests (${{ matrix.go.mode == 'file' && 'go.mod' || matrix.go.value }})
+        if: ${{ !startsWith(github.head_ref, 'doc/') }}
+        working-directory: ./backend
+        env:
+          JWT_SIGNING_KEY: "test-secret-key-for-testing"
+        run: go test ./...
 
   # Stable, aggregate check: require this going forward
   unit:
     name: unit
-    needs: [unit_go_123, unit_go_125]
+    needs: [unit_matrix]
     if: |
       startsWith(github.head_ref, 'feature/')
       || startsWith(github.head_ref, 'fix/')
       || startsWith(github.head_ref, 'refactor/')
       || startsWith(github.head_ref, 'doc/')
     runs-on: ubuntu-latest
     steps:
       - name: Publish aggregate unit status
-        run: echo "All unit jobs (1.23.x, 1.25.x) succeeded."
+        run: echo "All unit matrix jobs succeeded."
*** End Patch

Add this optional versions file

If you want to test multiple versions (or pin extras), create .github/go-versions:

*** Begin Patch
*** Add File: .github/go-versions
+# One entry per line. Two formats supported:
+#   file:<path-to-go.mod>  -> reads the language version from that go.mod
+#   <semver/range>         -> exact or x-wildcard like 1.26.x
+#
+# Default (if this file is missing): file:backend/go.mod
+
+file:backend/go.mod
+#1.26.x
+#1.25.x
*** End Patch


Comment/uncomment as needed. No workflow changes required.

One-time branch protection tweak

In GitHub ‚Üí Settings ‚Üí Branches ‚Üí Branch protection (for main):

Require status checks to pass:

‚úÖ Add: Backend / unit (pull_request)

üßπ Remove any versioned unit checks like unit (1.23.x)

From now on, add/remove Go versions by editing .github/go-versions (or bump your module‚Äôs go.mod) and the CI adapts‚Äîbranch protection stays the same.
The above patch should fix our unit testing. 

What to change in GitHub (one-time)

In repo, socialpredict.

Settings ‚Üí Branches ‚Üí Branch protection rule for main

Under Require status checks to pass, remove unit (1.23.x) and add Backend / unit (pull_request).

Leave your other checks as-is (e.g., CodeQL, smoke).

From now on, you can bump Go versions inside matrix.go-version freely (add 1.26.x, remove 1.25.x, etc.)‚Äîbranch protection will always key off the stable unit aggregator, so you‚Äôll never get the ‚ÄúExpected ‚Äî Waiting for status to be reported‚Äù stall again.

